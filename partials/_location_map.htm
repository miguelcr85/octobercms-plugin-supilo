<div id="map" style="width: 100%; height: 400px;"></div>

<!-- Latitude and Longitude hidden fields 
<input type="hidden" id="latitude" name="Product[latitude]" value="{{ formModel.latitude }}">
<input type="hidden" id="longitude" name="Product[longitude]" value="{{ formModel.longitude }}">
-->
<!-- Cargar Leaflet -->


<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Coordenadas iniciales (por ejemplo, Madrid)
        const initialLat =  -34.90653098860914;
        const initialLng = -56.186109781265266;

        // Crear el mapa y configurarlo
        const map = L.map('map').setView([initialLat, initialLng], 6);

        // A침adir la capa de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
           
        }).addTo(map);

        // Crear un marcador en la ubicaci칩n inicial y hacerlo arrastrable
        const marker = L.marker([initialLat, initialLng], { draggable: true }).addTo(map);

        // Actualizar los campos latitud y longitud cuando se mueve el marcador
        marker.on('dragend', function (e) {
            const position = marker.getLatLng();
            document.getElementById('Form-field-Product-latitude').value = position.lat;
            document.getElementById('Form-field-Product-longitude').value = position.lng;
        });

        // Actualizar marcador y mapa cuando se cambia la direcci칩n manualmente
        document.getElementById("Form-field-Product-address").addEventListener("keyup", function () {
            const geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(this.value)}`;

            fetch(geocodeUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const { lat, lon } = data[0];
                        map.setView([lat, lon], 13);
                        marker.setLatLng([lat, lon]);

                        // Actualizar campos de latitud y longitud
                        document.getElementById('Form-field-Product-latitude').value = lat;
                        document.getElementById('Form-field-Product-longitude').value = lon;
                    } else {
                        alert("Direcci칩n no encontrada");
                    }
                });
        });
    });
</script>
